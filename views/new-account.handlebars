<div class="container col-sm-12">

    <script>
        function checkSamePasswords() {
            if (document.newForm.password !== document.newForm.confirmedPassword) {
                return false;
            } else {
                return true;
            }
        }
    </script>

    

    <h1>New Account</h1>
    <form name="newForm" onsubmit="checkSamePasswords()" action="./submit" method="POST">
        <p>Choose your avatar:
            <div class="avatorcontainer">
           <div  class="avatar"> <label><input type="radio" name="avatar" id="blue" value="blue.png"  ><img src="./avatar/blue.png" width="90"></label> </div>
           <div  class="avatar"> <label><input type="radio" name="avatar" id="girl" value="girl.png" ><img src="./avatar/girl.png" width="90"></label> </div> 
           <div  class="avatar"> <label><input type="radio" name="avatar" id="pink" value="pink.png" > <img src="./avatar/pink.png" width="90"></label> </div> 
           <div  class="avatar"> <label><input type="radio" name="avatar" id="dragonite" value="Dragonite.png" > <img src="./avatar/Dragonite.png" width="120"></label> </div> 
           <div  class="avatar">  <label><input type="radio" name="avatar" id="turtle" value="turtle.png" ><img src="./avatar/turtle.png" width="150"></label> </div> 
           <div  class="avatar">  <label><input type="radio" name="avatar" id="mouse" value="mouse.png" > <img src="./avatar/mouse.png" width="90"></label> </div> 
           <div  class="avatar">  <label><input type="radio" name="avatar" id="mickey" value="Mickey_Mouse_Disney_1.webp" > <img src="./avatar/Mickey_Mouse_Disney_1.webp" width="90"></label> </div> 
            </div>
        </p>
        
    <script>
            async function checkUsername(){

                const input = document.getElementById("txtUsername");
                //input.value = "Hacked!"; //ok
                
               // Method 1: Fetch all users data and verify username availability
                const all = await fetch("http://localhost:3000/checkUsername", {
                    method: "get",
                });
                const allUsers = await all.json();
                console.log(allUsers);//xx

                //var input = document.getElementById('inpputId');
                //var parameters=input.name+"="+input.value;
                //var http=new XMLHttpRequest();
                //http.open('POST','yourfile.php',true);
                //http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                //http.setRequestHeader("Content-length", parameters.length);
                //http.setRequestHeader("Connection", "close");
                //http.onload=function(){
                    cosole.log("send param works");

                // After receiving all users data, verify username availibility
                    allUsers.forEach(function(user){
                        if(input.value !== user.username){
                            console.log("Username available.");
                                return;
                        }else{
                            console.log("Username existed!");
                                input.value = "Username existed!";
                                return input.value;
                        }
                    });
                }
                //http.send(parameters);


                
    
                
            }
    </script> 


        <p>
            <label for="txtUsername">Username:</label>

            <input type="text" name="username" id="txtUsername" class="txtbox" placeholder="must be unique" onkeyup="checkUsername()"  >


        </p>
        <p>
            <label for="txtPassword">Choose password:</label>
            <input type="password" name="password" id="txtPassword" class="txtbox"
                placeholder="any combination of a.Z.1.8.$">
        </p>
        <p>
            <label for="txtPasswordRe">Re-enter password:</label>
            <input type="password" name="confirmedPassword" id="txtPasswordRe" class="txtbox"
                placeholder="must be the same as the chosen one">
        </p>
        <p>
            <label for="txtName">Name:</label>
            <input type="text" name="name" id="txtName" class="txtbox" placeholder="full name">
        </p>
        <p>
            <label for="txtBirthdat">Birthday:</label>
            <input type="text" name="birthday" id="txtBirthday" class="txtbox" placeholder="YYYY/MM/DD">
            
        </p>
        <p>
            <label for="email">Email:</label>
            <input type="email" name="email" id="email" class="txtbox" placeholder="xx@yy">
        </p>
        <p>
            <label for="txtIntroduction">Self Introduction:</label>
            <textarea id="txtIntroduction" class="txtbox" rows="4" cols="40" name="introduction"
                placeholder="briefly introduce yourself.."></textarea>
        </p>
        <p>
            <button type="submit" class="btn">Create account</button>
        </p>
    </form>
    <div ><p><small>Log in now?</small></p>
    <button type="button" class="btn" onclick="window.location.href='./login';" >Login</button>

</div>
